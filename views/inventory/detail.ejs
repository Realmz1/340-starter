<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head', { title: title }) %>
</head>

<body>
  <a class="skip-link" href="#main-content">Skip to content</a>
  <div class="page">
    <%- include('../partials/header') %>
      <%- include('../partials/nav', { nav: nav }) %>

        <main id="main-content">
          <h1>
            <%= title %>
          </h1>

          <% if (locals.notice) { %>
            <div class="flash notice">
              <%= notice %>
            </div>
            <% } %>

              <div class="detail-wrapper">
                <%- content %>
              </div>

              <!-- Reviews Section -->
              <section class="reviews-section">
                <h2>Customer Reviews (<%= reviews.length %>)</h2>

                <% if (reviews && reviews.length> 0) { %>
                  <ul class="reviews-list">
                    <% reviews.forEach(review=> { %>
                      <li class="review-item">
                        <div class="review-header">
                          <strong>
                            <%= review.account_firstname %>
                              <%= review.account_lastname %>
                          </strong>
                          <span class="review-rating">
                            <% for(let i=1; i <=5; i++) { %>
                              <% if(i <=review.review_rating) { %>
                                ★
                                <% } else { %>
                                  ☆
                                  <% } %>
                                    <% } %>
                          </span>
                          <span class="review-date">
                            <%= new Date(review.review_date).toLocaleDateString() %>
                          </span>
                        </div>
                        <p class="review-text">
                          <%= review.review_text %>
                        </p>
                      </li>
                      <% }) %>
                  </ul>
                  <% } else { %>
                    <p>No reviews yet. Be the first to review this vehicle!</p>
                    <% } %>

                      <!-- Add Review Form (only for logged-in users) -->
                      <% if (locals.loggedin) { %>
                        <div class="add-review-form">
                          <h3>Write a Review</h3>
                          <form action="/review/add" method="post">
                            <fieldset>
                              <legend>Share Your Experience</legend>

                              <label for="review_rating">Rating:</label>
                              <select id="review_rating" name="review_rating" required>
                                <option value="">Select rating</option>
                                <option value="5">★★★★★ (5 - Excellent)</option>
                                <option value="4">★★★★☆ (4 - Very Good)</option>
                                <option value="3">★★★☆☆ (3 - Good)</option>
                                <option value="2">★★☆☆☆ (2 - Fair)</option>
                                <option value="1">★☆☆☆☆ (1 - Poor)</option>
                              </select>

                              <label for="review_text">Your Review:</label>
                              <textarea id="review_text" name="review_text" rows="5" required minlength="10"
                                maxlength="1000"
                                placeholder="Tell us about your experience with this vehicle..."></textarea>
                              <p class="form-note">Minimum 10 characters, maximum 1000 characters</p>

                              <input type="hidden" name="inventory_id" value="<%= inventory_id %>">

                              <button type="submit">Submit Review</button>
                            </fieldset>
                          </form>
                        </div>
                        <% } else { %>
                          <p><a href="/account/login">Log in</a> to write a review.</p>
                          <% } %>
              </section>
        </main>

        <%- include('../partials/footer') %>
  </div>
  <script src="/js/script.js" defer></script>
</body>

</html>